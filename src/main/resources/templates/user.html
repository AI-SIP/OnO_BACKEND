<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OnO 관리자 - 유저 상세</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
  <!-- Navigation Bar -->
  <nav class="bg-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <a th:href="@{/admin/main}">
            <h1 class="text-2xl font-bold text-indigo-600">OnO 관리자</h1>
          </a>
        </div>
        <div class="flex items-center space-x-4">
          <a th:href="@{/admin/main}" class="text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">
            대시보드
          </a>
          <a th:href="@{/admin/users}" class="text-indigo-600 px-3 py-2 rounded-md text-sm font-medium border-b-2 border-indigo-600">
            유저
          </a>
          <a th:href="@{/admin/problems}" class="text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">
            문제
          </a>
          <a th:href="@{/admin/analysis}" class="text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">
            통계
          </a>
          <form th:action="@{/logout}" method="post">
            <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium transition duration-150">
              로그아웃
            </button>
          </form>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Back Button -->
    <div class="mb-4">
      <a th:href="@{/admin/users}" class="text-indigo-600 hover:text-indigo-800 flex items-center">
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
        유저 목록으로 돌아가기
      </a>
    </div>

    <!-- User Details Card -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <div class="flex justify-between items-start mb-6">
        <h2 class="text-2xl font-bold text-gray-900">유저 상세 정보</h2>
        <button onclick="deleteUser()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium transition">
          유저 삭제
        </button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- User Information -->
        <div class="space-y-4">
          <div>
            <label class="text-sm font-medium text-gray-500">유저 ID</label>
            <p class="mt-1 text-lg font-semibold text-gray-900" th:text="${user.userId}">1</p>
          </div>
          <div>
            <label class="text-sm font-medium text-gray-500">이름</label>
            <p class="mt-1 text-lg text-gray-900" th:text="${user.name}">유저 이름</p>
          </div>
          <div>
            <label class="text-sm font-medium text-gray-500">이메일</label>
            <p class="mt-1 text-lg text-gray-900" th:text="${user.email}">user@example.com</p>
          </div>
          <div>
            <label class="text-sm font-medium text-gray-500">가입일</label>
            <p class="mt-1 text-lg text-gray-900" th:text="${#temporals.format(user.createdAt, 'yyyy-MM-dd HH:mm:ss')}">2024-01-01 00:00:00</p>
          </div>
        </div>

        <!-- Stats -->
        <div class="space-y-4">
          <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-lg p-4">
            <label class="text-sm font-medium text-indigo-700">총 학습 레벨</label>
            <div class="mt-2 flex items-baseline">
              <p class="text-3xl font-bold text-indigo-600" th:text="'Lv.' + ${user.totalStudyLevel}">Lv.1</p>
              <p class="ml-2 text-sm text-indigo-500" th:text="'(' + ${user.totalStudyCurrentPoint} + '/' + ${user.totalStudyNextLevelThreshold} + ' pt)'"> (0/40 pt)</p>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div class="bg-blue-50 rounded-lg p-3">
              <label class="text-xs font-medium text-blue-700">출석</label>
              <p class="text-lg font-semibold text-blue-600" th:text="'Lv.' + ${user.attendanceLevel}">Lv.1</p>
            </div>
            <div class="bg-green-50 rounded-lg p-3">
              <label class="text-xs font-medium text-green-700">오답노트 작성</label>
              <p class="text-lg font-semibold text-green-600" th:text="'Lv.' + ${user.noteWriteLevel}">Lv.1</p>
            </div>
            <div class="bg-purple-50 rounded-lg p-3">
              <label class="text-xs font-medium text-purple-700">문제 복습</label>
              <p class="text-lg font-semibold text-purple-600" th:text="'Lv.' + ${user.problemPracticeLevel}">Lv.1</p>
            </div>
            <div class="bg-pink-50 rounded-lg p-3">
              <label class="text-xs font-medium text-pink-700">복습노트 사용</label>
              <p class="text-lg font-semibold text-pink-600" th:text="'Lv.' + ${user.notePracticeLevel}">Lv.1</p>
            </div>
          </div>

          <div class="bg-gray-50 rounded-lg p-4">
            <label class="text-sm font-medium text-gray-700">총 문제 수</label>
            <p class="mt-1 text-2xl font-bold text-gray-900" th:text="${problemCount}">0</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Problems Section -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-4">유저가 작성한 문제</h3>
      <p class="text-gray-600 mb-4">총 <span class="font-semibold text-indigo-600" th:text="${problemCount}">0</span>개의 문제</p>

      <div th:if="${problemCount > 0}" class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">메모</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">출처</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">이미지</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">푼 날짜</th>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">작성일</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr th:each="problem : ${problems}" class="hover:bg-gray-50">
              <td class="px-4 py-3 text-sm font-medium text-gray-900" th:text="${problem.problemId}">1</td>
              <td class="px-4 py-3 text-sm text-gray-600">
                <span th:if="${problem.memo != null and !problem.memo.isEmpty()}" th:text="${#strings.abbreviate(problem.memo, 30)}">메모...</span>
                <span th:unless="${problem.memo != null and !problem.memo.isEmpty()}" class="text-gray-400">-</span>
              </td>
              <td class="px-4 py-3 text-sm text-gray-600">
                <span th:if="${problem.reference != null and !problem.reference.isEmpty()}" th:text="${problem.reference}">출처</span>
                <span th:unless="${problem.reference != null and !problem.reference.isEmpty()}" class="text-gray-400">-</span>
              </td>
              <td class="px-4 py-3 text-sm text-gray-600">
                <div class="flex space-x-1">
                  <span th:each="image : ${problem.imageUrlList}" class="inline-block">
                    <a th:href="@{/admin/user/image/view(url=${image.imageUrl})}" target="_blank" class="text-indigo-600 hover:text-indigo-800">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                    </a>
                  </span>
                  <span th:if="${#lists.isEmpty(problem.imageUrlList)}" class="text-gray-400">이미지 없음</span>
                </div>
              </td>
              <td class="px-4 py-3 text-sm text-gray-600">
                <span th:if="${problem.solvedAt != null}" th:text="${#temporals.format(problem.solvedAt, 'yyyy-MM-dd')}">2024-01-01</span>
                <span th:unless="${problem.solvedAt != null}" class="text-gray-400">-</span>
              </td>
              <td class="px-4 py-3 text-sm text-gray-600" th:text="${#temporals.format(problem.createdAt, 'yyyy-MM-dd HH:mm')}">2024-01-01 00:00</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div th:unless="${problemCount > 0}" class="text-center py-8 text-gray-500">
        이 유저가 작성한 문제가 없습니다
      </div>
    </div>
  </div>

  <!-- Delete User Script -->
  <script th:inline="javascript">
    function deleteUser() {
      if (confirm("정말 이 유저를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.")) {
        const userId = /*[[${user.userId}]]*/ 1;
        fetch(`/admin/user/${userId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          if (response.ok) {
            alert("유저가 성공적으로 삭제되었습니다");
            window.location.href = "/admin/users";
          } else {
            alert("유저 삭제에 실패했습니다");
          }
        })
        .catch(error => {
          console.error("유저 삭제 중 에러 발생:", error);
          alert("유저 삭제에 실패했습니다");
        });
      }
    }
  </script>
</body>
</html>